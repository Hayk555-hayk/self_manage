<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Profile</title> <link rel="stylesheet" href="assets/profile.css">
</head>
<body>
  <div class="header-section">
    <h2>Profile</h2> <p id="user-email"></p>
    <button id="logout-btn">Log Out</button> </div>
    <h5><a href="finance_manager.html">Finance Manager</a></h5>
    <h5><a href="motivation_tracker.html">Motivation Tracker</a></h5>

  <div class="goals-section">
    <h3>Goals</h3> <form id="goal-form">
      <input type="text" id="goal-input" placeholder="New main goal"> <button>Add</button> </form>

    <ul id="goal-list">
      </ul>
  </div>

  <div id="subgoal-modal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" id="close-subgoal-modal">&times;</button>
      <h4>Subgoals for: <span id="current-goal-title"></span></h4> <form id="subgoal-form">
        <input type="text" id="subgoal-input" placeholder="New sub-goal"> <button type="submit">Add Subgoal</button> </form>

      <ul id="subgoal-list">
        </ul>
    </div>
  </div>

  <div id="self-task">
<table border="1">
  <caption>–†–ê–°–ü–û–†–Ø–î–û–ö –î–ù–Ø</caption>

  <tr>
    <th>–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö</th>
    <th>–í–¢–û–†–ù–ò–ö</th>
    <th>–°–†–ï–î–ê</th>
    <th>–ß–ï–¢–í–ï–†–ì</th>
    <th>–ü–Ø–¢–ù–ò–¶–ê</th>
    <th>–°–£–ë–ë–û–¢–ê</th>
    <th>–í–û–°–ö–†–ï–°–ï–ù–¨–ï</th>
  </tr>
  <tr>
    <td>–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é (AcBa Udemy - RESTfull API —Å ASP.NET Core Web API —á–∞—Å—Ç—å 1)üíª</td>
    <td>–°–ø–æ—Ä—Ç —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª (–≥—Ä—É–¥—å, —Ç—Ä–∏—Ü–µ–ø—Å –∏ –∫–∞—Ä–¥–∏–æ + –ø—Ä–µ—Å—Å)üèÄ</td>
    <td>–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é (AcBa Udemy - NodeJS - The Complete Guide (MVC, REST APIs, GraphQL, Deno))üíª</td>
    <td>–°–ø–æ—Ä—Ç —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª (—Å–ø–∏–Ω–∞, –±–∏—Ü–µ–ø—Å –∏ –∫–∞—Ä–¥–∏–æ + –ø—Ä–µ—Å—Å)üèÄ</td>
    <td>–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é (AcBa Udemy - SQL Development with MS SQL Server Beginner to Master 2025)üíª</td>
    <td>–°–ø–æ—Ä—Ç —Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª (–Ω–æ–≥–∏, –ø–ª–µ—á–∏ –∏ –∫–∞—Ä–¥–∏–æ + –ø—Ä–µ—Å—Å)üèÄ</td>
    <td>–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é (YouTube project - React + .NET Core Finance Project)üíª</td>
  </tr>
  <tr>
    <td>–†–µ–ª–∏–≥–∏—è (–ß—Ç–µ–Ω–∏–µ –ë–∏–±–ª–∏–∏ –ø–æ App)‚õ™</td>
    <td>–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (YouTube: DA VINCI Video Courses –∫—É—Ä—Å –ø–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–µ)üßÆ</td>
    <td>–†–µ–ª–∏–≥–∏—è (–ß—Ç–µ–Ω–∏–µ –ë–∏–±–ª–∏–∏ –ø–æ –ö–Ω–∏–≥–µ –Ω–∞ –ê—Ä–º—è–Ω—Å–∫–æ–º)‚õ™</td>
    <td>–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (YouTube: –ì–∞—Ä–≤–∞—Ä–¥—Å–∫–∏–π –∫—É—Ä—Å –ø–æ –æ—Å–Ω–æ–≤–∞–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è)üßÆ</td>
    <td>–†–µ–ª–∏–≥–∏—è (–ù–∞–ø–∏—Å–∞–Ω–∏–µ –ü–∏—Å—å–º–∞)‚õ™</td>
    <td>–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (YouTube: DA VINCI Video Courses –∫—É—Ä—Å –ø–æ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–µ)üßÆ</td>
    <td>–ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (YouTube: –ì–∞—Ä–≤–∞—Ä–¥—Å–∫–∏–π –∫—É—Ä—Å –ø–æ –æ—Å–Ω–æ–≤–∞–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è)üßÆ</td>
  </tr>
    <tr>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
    <td>–í–æ–∂–¥–µ–Ω–∏–µ —Ç–∞–∫—Å–∏ üöñ</td>
  </tr>
  <tr>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
    <td>–°–ø–æ—Ä—Ç –¥–æ–º–∞ ‚öΩ</td>
  </tr>
</table>


  </div>
  
  <script type="module">
    import { auth } from "./js/firebase-config.js";
    import { logout } from "./js/auth.js";
    import { initGoals, addSubgoal, renderSubgoals, initSelfTask } from "./js/multiController.js"; 
    
    // Insert or ensure you have the qs function (querySelector shortcut)
    const qs = (id) => document.getElementById(id);
    const showMessage = (msg) => console.log(msg); // Replace with your actual notification function

    // ----------------- Authentication -----------------
    auth.onAuthStateChanged(user => {
      if (user) {
        // –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: -> You are logged in as: 
        qs("user-email").textContent = "You are logged in as: " + user.email;
        initGoals();

        if(user.email === 'hayk@mail.com') {
          initSelfTask();
        }
      } else {
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à–µ–ª, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ -> If the user is not logged in, redirect to the login page
        window.location.href = "login.html"; 
      }
    });

    qs("logout-btn").onclick = () => logout();

    // ----------------- Modal Window Management -----------------
    let currentGoalId = null;

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -> Closing the modal window
    qs("close-subgoal-modal").onclick = () => {
        qs("subgoal-modal").style.display = 'none';
        currentGoalId = null;
    };
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–µ–ª–∏ (–¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞)
    // Handling click on the main goal (to open the modal window)
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Å –∫–ª–∞—Å—Å–æ–º 'goal-item'
    // Process clicks only on elements with the class 'goal-item'
    qs("goal-list").addEventListener('click', (e) => {
        const goalElement = e.target.closest('.goal-item');
        
        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –º—ã –Ω–µ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ü–µ–ª–∏
        // Ensure we didn't click on an edit/delete button inside the goal
        if (goalElement && !e.target.closest('button')) { 
            currentGoalId = goalElement.dataset.id;
            // –¶–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –±–µ—Ä–µ–º title –∏–∑ data
            // The goal may contain multiple child elements, taking the title from data
            const goalTitle = goalElement.dataset.title || 'Untitled goal'; // –¶–µ–ª—å –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è -> Untitled goal 

            qs("current-goal-title").textContent = goalTitle;
            renderSubgoals(currentGoalId); // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–¥—Ü–µ–ª–∏ –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏ -> Display subgoals for this goal
            qs("subgoal-modal").style.display = 'flex';
        }
    });

    // ----------------- Adding Subgoal -----------------
    qs("subgoal-form").onsubmit = async (e) => {
        e.preventDefault();
        const subgoalText = qs("subgoal-input").value.trim();
        
        if (subgoalText && currentGoalId) {
            try {
                // –í–ê–ñ–ù–û: –í–∞—à–∞ —Ñ—É–Ω–∫—Ü–∏—è addSubgoal –≤ multiController —Å–µ–π—á–∞—Å —è–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π. 
                // –û–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Firestore.
                // IMPORTANT: Your addSubgoal function in multiController is currently a placeholder.
                // It must be implemented for real Firestore functionality.
                await addSubgoal(currentGoalId, subgoalText); 
                qs("subgoal-input").value = '';
                // renderSubgoals(currentGoalId); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥—Ü–µ–ª–µ–π –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ -> Update the list of subgoals in the modal window
            } catch (error) {
                // –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥—Ü–µ–ª–∏: -> Error adding sub-goal: 
                showMessage("Error adding sub-goal: " + error.message);
            }
        }
    };
  </script>
</body>
</html>