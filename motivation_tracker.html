<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Motivation Tracker</title>
    <link rel="stylesheet" href="assets/motivation.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <h2>üöÄ Motivation Progress Tracker</h2>
        <p id="user-email"></p>
        <button id="logout-btn" class="logout-btn">Log Out</button>
        <h5><a href="profile.html">Goals</a></h5>
        <h5><a href="finance_manager.html">Finance Manager</a></h5>

        <section class="goals-management-section">
            <h3>üéØ Manage Goals</h3>
            <form id="goal-form" class="input-form">
                <input type="text" id="goal-title" placeholder="New Goal Title (e.g., 'Learn Coding', 'Fitness')" required>
                <button type="submit">Add Goal</button>
            </form>
            <ul id="goals-list">
                </ul>
        </section>

        <section class="rating-section">
            <h3>‚úÖ Daily Motivation Rating</h3>
            <form id="rating-form" class="input-form">
                <select id="goal-select" required>
                    <option value="" disabled selected>Select Goal Achieved</option>
                    </select>
                <select id="score-select" required>
                    <option value="" disabled selected>‚ú® –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É ‚ú®</option>
                    <option value="100">üöÄ +100 (–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π –ü—Ä–æ–≥—Ä–µ—Å—Å!)</option>
                    <option value="80">üåü +80 (–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)</option>
                    <option value="50">üëç +50 (–•–æ—Ä–æ—à–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å)</option>
                    <option value="30">‚úÖ +30 (–ù–µ–±–æ–ª—å—à–æ–π —Å–¥–≤–∏–≥)</option>
                    <option value="15">üå± +15 (–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —É—Å–∏–ª–∏–µ)</option>
                    <option value="-1">üòê -1 (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π/–ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞)</option>
                    <option value="-15">üêå -15 (–û—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ)</option>
                    <option value="-30">‚ö†Ô∏è -30 (–ù–µ–±–æ–ª—å—à–æ–π –æ—Ç–∫–∞—Ç)</option>
                    <option value="-50">‚ùå -50 (–ù–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è)</option>
                    <option value="-80">üìâ -80 (–°–µ—Ä—å–µ–∑–Ω—ã–π –ø—Ä–æ–≤–∞–ª)</option>
                    <option value="-100">üö® -100 (–ü–æ–ª–Ω—ã–π —Å—Ä—ã–≤/–ë–æ–ª—å—à–æ–π —Ä–µ–≥—Ä–µ—Å—Å)</option>
                </select>
                <input type="text" id="log-notes" placeholder="Notes (Optional)">
                <button type="submit">Log Progress</button>
            </form>
        </section>

        <section class="charts-section">
            <h3>üìà Progress Over Time (Per Goal)</h3>
            
            <div class="date-range-filter">
                <h4>Filter Log History:</h4>
                <div class="input-form">
                    <label for="start-date">Start Date:</label>
                    <input type="date" id="start-date" required>
                    
                    <label for="end-date">End Date:</label>
                    <input type="date" id="end-date" required>
                    
                    <button id="apply-filter-btn" type="button">Apply Filter</button>
                </div>
            </div>

            <div class="chart-card">
                <canvas id="chartMotivation"></canvas>
            </div>
            
            <h3>üìú Motivation Log History</h3>
            <ul id="log-history-list">
                </ul>
        </section>

    </div>

    <script type="module">
        import { auth } from "./js/firebase-config.js";
        import { logout } from "./js/auth.js";
        import { initMotivationController, addGoal, addMotivationLog, deleteLog, loadLogsForUser } from "./js/motivationController.js";
        
        const qs = (id) => document.getElementById(id);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤ —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–∞
        const loadFilteredLogs = () => {
            const startDate = qs('start-date').value;
            const endDate = qs('end-date').value;
            loadLogsForUser(startDate, endDate);
        };

        auth.onAuthStateChanged(user => {
            if (user) {
                qs("user-email").textContent = "Logged in as: " + user.email;
                // initMotivationController —Ç–µ–ø–µ—Ä—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞—Ç—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É
                initMotivationController(user.uid); 
            } else {
                window.location.href = "login.html"; 
            }
        });

        qs("logout-btn").onclick = () => logout();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞
        qs("apply-filter-btn").onclick = () => loadFilteredLogs();

        qs("goal-form").onsubmit = async (e) => {
            e.preventDefault();
            const title = qs("goal-title").value.trim();
            if (title) {
                await addGoal(title);
                qs("goal-title").value = '';
            }
        };

        qs("rating-form").onsubmit = async (e) => {
            e.preventDefault();
            const goalId = qs("goal-select").value;
            const score = parseInt(qs("score-select").value);
            const notes = qs("log-notes").value.trim();
            
            if (goalId && !isNaN(score)) {
                await addMotivationLog(goalId, score, notes);
                qs("log-notes").value = '';
                qs("score-select").value = '';
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –¥–ª—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è onSnapshot)
                loadFilteredLogs(); 
            } else {
                alert("Please select a goal and a score.");
            }
        };

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é deleteLog –≤ –≥–ª–æ–±–∞–ª—å–Ω—ã–π scope –¥–ª—è –∫–Ω–æ–ø–∫–∏
        window.deleteLog = deleteLog; 
    </script>
</body>
</html>